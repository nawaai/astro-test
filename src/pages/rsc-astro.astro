---
// RSC Pattern Demo in Astro (Static Build)
// Reference: https://overreacted.io/rsc-for-astro-developers

import ServerCard from '../react/ServerCard.jsx';
import ClientCounter from '../react/ClientCounter.jsx';

// Server-side data fetching at BUILD TIME (static generation)
const response = await fetch('https://uselessfacts.jsph.pl/api/v2/facts/random');
const factData = await response.json();
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>RSC Pattern in Astro (Static)</title>
		<style>
			body {
				font-family: system-ui, sans-serif;
				max-width: 800px;
				margin: 2rem auto;
				padding: 0 1rem;
			}
			.comparison {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 1rem;
				margin: 2rem 0;
			}
			@media (max-width: 600px) {
				.comparison { grid-template-columns: 1fr; }
			}
			code {
				background: #f0f0f0;
				padding: 0.2em 0.4em;
				border-radius: 3px;
			}
			.note {
				background: #fffbe6;
				border-left: 4px solid #ffe58f;
				padding: 1rem;
				margin: 1rem 0;
			}
		</style>
	</head>
	<body>
		<h1>RSC Pattern in Astro (Static)</h1>
		<p><a href="/">← Back to Home</a> | <a href="/rsc">→ See Next.js RSC (SSR)</a></p>

		<div class="note">
			<strong>Note:</strong> This page is statically generated at build time.
			Data was fetched when the site was built and won't change on refresh.<br/><br/>
			<strong>Want fresh data on every request?</strong> <a href="/rsc">See the Next.js RSC demo</a> which uses true SSR.
		</div>

		<h2>The Pattern</h2>
		<div class="comparison">
			<div>
				<h4>RSC Terminology</h4>
				<ul>
					<li><code>"use server"</code> → Server Component</li>
					<li><code>"use client"</code> → Client Component</li>
				</ul>
			</div>
			<div>
				<h4>Astro Equivalent</h4>
				<ul>
					<li>No directive → Server-only (0 JS)</li>
					<li><code>client:load</code> → Hydrated Island</li>
				</ul>
			</div>
		</div>

		<h2>Live Demo</h2>

		<h3>1. Server Component with API Fetch</h3>
		<p>Data fetched from <code>uselessfacts.jsph.pl</code> at build/request time:</p>
		<!-- No client directive = Server Component equivalent -->
		<ServerCard fact={factData.text} source={factData.source_url} />

		<h3>2. Client Component (Interactive)</h3>
		<!-- client:load = "use client" equivalent -->
		<ClientCounter client:load initialCount={0} />

		<h2>How It Works</h2>
		<pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 8px; overflow-x: auto;"><code>{`// In Astro frontmatter (server-side):
const response = await fetch('https://uselessfacts.jsph.pl/api/v2/facts/random');
const factData = await response.json();

// Server Component - no client:* directive
<ServerCard fact={factData.text} source={factData.source_url} />

// Client Component - with client:load directive
<ClientCounter client:load initialCount={0} />`}</code></pre>

		<h2>Key Differences</h2>
		<ul>
			<li><strong>Astro:</strong> Multi-framework (React, Vue, Svelte, etc.) with Islands</li>
			<li><strong>RSC:</strong> React-only, but with seamless server/client boundary</li>
			<li><strong>Astro:</strong> Explicit <code>client:*</code> directives for hydration</li>
			<li><strong>RSC:</strong> <code>"use client"</code> directive at file level</li>
		</ul>

		<p style="margin-top: 2rem; color: #666;">
			<small>Reference: <a href="https://overreacted.io/rsc-for-astro-developers" target="_blank">RSC for Astro Developers</a> by Dan Abramov</small>
		</p>
	</body>
</html>
