---
// RSC Pattern Demo in Astro
// Reference: https://overreacted.io/rsc-for-astro-developers

import ServerCard from '../react/ServerCard.jsx';
import RefreshButton from '../react/RefreshButton.jsx';
import ClientFact from '../react/ClientFact.jsx';
import ClientCounter from '../react/ClientCounter.jsx';

// Server-side data fetching (runs at BUILD TIME for static output)
// For fresh data, use the ClientFact component which fetches on client
const response = await fetch('https://uselessfacts.jsph.pl/api/v2/facts/random');
const factData = await response.json();
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>RSC Pattern in Astro</title>
		<style>
			body {
				font-family: system-ui, sans-serif;
				max-width: 800px;
				margin: 2rem auto;
				padding: 0 1rem;
			}
			.comparison {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 1rem;
				margin: 2rem 0;
			}
			@media (max-width: 600px) {
				.comparison { grid-template-columns: 1fr; }
			}
			code {
				background: #f0f0f0;
				padding: 0.2em 0.4em;
				border-radius: 3px;
			}
			.note {
				background: #fffbe6;
				border-left: 4px solid #ffe58f;
				padding: 1rem;
				margin: 1rem 0;
			}
		</style>
	</head>
	<body>
		<h1>RSC Pattern in Astro</h1>
		<p><a href="/">← Back to Home</a></p>

		<div class="note">
			<strong>Key Insight:</strong> Astro's architecture is conceptually similar to React Server Components.
			Both separate "server-only" code from "client-interactive" code.
		</div>

		<h2>The Pattern</h2>
		<div class="comparison">
			<div>
				<h4>RSC Terminology</h4>
				<ul>
					<li><code>"use server"</code> → Server Component</li>
					<li><code>"use client"</code> → Client Component</li>
				</ul>
			</div>
			<div>
				<h4>Astro Equivalent</h4>
				<ul>
					<li>No directive → Server-only (0 JS)</li>
					<li><code>client:load</code> → Hydrated Island</li>
				</ul>
			</div>
		</div>

		<h2>Live Demo: Data Fetching</h2>

		<h3>1. Server Fetch + Page Reload</h3>
		<p>Data fetched on server, refresh triggers page reload:</p>
		<ServerCard fact={factData.text} source={factData.source_url}>
			<RefreshButton client:load />
		</ServerCard>

		<h3>2. Client Fetch (No Reload)</h3>
		<p>Initial data from server, refetch happens on client:</p>
		<ClientFact client:load initialFact={factData.text} initialSource={factData.source_url} />

		<h2>Interactive Component</h2>
		<h3>3. Client Counter</h3>
		<ClientCounter client:load initialCount={0} />

		<h2>How It Works</h2>
		<pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 8px; overflow-x: auto;"><code>{`// Server-side fetch (in Astro frontmatter)
const response = await fetch('https://uselessfacts.jsph.pl/...');
const factData = await response.json();

// Option 1: Server Component + tiny client island for refresh
<ServerCard fact={factData.text} source={factData.source_url}>
  <RefreshButton client:load />  // Only button is hydrated
</ServerCard>

// Option 2: Full client component with client-side fetch
<ClientFact client:load initialFact={factData.text} ... />

// Option 3: Pure client interactivity
<ClientCounter client:load initialCount={0} />`}</code></pre>

		<h2>Key Differences</h2>
		<ul>
			<li><strong>Astro:</strong> Multi-framework (React, Vue, Svelte, etc.) with Islands</li>
			<li><strong>RSC:</strong> React-only, but with seamless server/client boundary</li>
			<li><strong>Astro:</strong> Explicit <code>client:*</code> directives for hydration</li>
			<li><strong>RSC:</strong> <code>"use client"</code> directive at file level</li>
		</ul>

		<p style="margin-top: 2rem; color: #666;">
			<small>Reference: <a href="https://overreacted.io/rsc-for-astro-developers" target="_blank">RSC for Astro Developers</a> by Dan Abramov</small>
		</p>
	</body>
</html>
